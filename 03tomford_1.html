<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EFFÉ</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="EFFE.css" />
    <link rel="stylesheet" href="reset.css" />
</head>
<body>
    <div id="header"></div>
    <div class="firstSec"></div>
        <section class="tomI01">
            <div class="tomILogo"><img src="./source_02TOM_FORD/logo.png" alt="logo"></div>
            <div class="tomILogoSen">Seduction in Precision</div>
            <div class="tomIMain"><video autoplay muted src="./source_02TOM_FORD/12.mp4"></video></div>
            <div class="tomIValue">
                <div class="lineHW"></div>
                <div class="tomIVText">“Luxury is a bold statement, combining elegance and power in every detail.”</div>
                <div class="lineHW"></div>
            </div>
        </section>
        <section class="tomI02">
            <div class="tomICon">
                <div class="tomIConSen">Power of Presence</div>
                <div class="tomIConBox">
                    <div class="tomIConImg"><img src="./source_02TOM_FORD/548.jpg" alt="img"></div>
                    <div></div>
                </div>
            </div>
            <div class="tomICon">
                <div class="tomIConBox">
                    <div class="tomIConImg"><img src="./source_02TOM_FORD/07.jpg" alt="img"></div>
                    <div></div>
                </div>
                <div class="tomIConSen">Seductive Luxury</div>
            </div>
        </section>
    <div class="lineV"></div>
    <section class="tomI03">
        <div class="flipCardT">
            <div class="flipCardInT">
                <div class="flipFrontT">
                    <div class="frontImg"><img src="./source_02TOM_FORD/Oud_Wood.jpg" alt="img"></div>
                </div>
                <div class="flipBackT">
                    <div class="lineHW"></div>
                    <div>Oud Wood</div>
                    <div>x</div>
                    <div>dark | exotic | refined masculinity</div>
                    <div class="lineHW"></div>
                </div>
            </div>
        </div>
        <div class="flipCardT">
            <div class="flipCardInT">
                <div class="flipFrontT">
                    <div class="frontImg"><img src="./source_02TOM_FORD/Black_Orchid.jpg" alt="img"></div>
                </div>
                <div class="flipBackT">
                    <div class="lineHW"></div>
                    <div>Black Orchid</div>
                    <div>x</div>
                    <div>opulent | mysterious | timeless seduction</div>
                    <div class="lineHW"></div>
                </div>
            </div>
        </div>
        <div class="flipCardT">
            <div class="flipCardInT">
                <div class="flipFrontT">
                    <div class="frontImg"><img src="./source_02TOM_FORD/Neroli_Portofino.jpg" alt="img"></div>
                </div>
                <div class="flipBackT">
                    <div class="lineHW"></div>
                    <div>Neroli Portofino</div>
                    <div>x</div>
                    <div>citrus | crisp | coastal luxury</div>
                    <div class="lineHW"></div>
                </div>
            </div>
        </div>
    </section>
    <section class="tomI04">
        <div class="lineV"></div>
        <div class="tomFSen">
            opulent · sensual · dark luxury
        </div>
        <div class="tomFImgBox">
            <div class="tomFImg">
                <img src="./source_style/04_02.jpg" alt="img">
            </div>
            <div class="tomFImg">
                <img src="./source_02TOM_FORD/13.jpg" alt="img">
            </div>
        </div>
        <div class="lineH"></div>
    </section>
    <section class="tomI05">
        <div class="tomIMapText">TOM FORD Store</div>
        <div class="mapTypeBox">
            <button data-type="traffic">실시간 교통정보 보기</button> 
            <button data-type="bicycle">자전거도로 보기</button>
            <button onclick="changeMarker('store')">주변 편의점 보기</button>
            <button onclick="changeMarker('carpark')">주변 주차장 보기</button>
        </div> 
        <div class="tomMap"></div>
        <div class="searchBox">
            <input type="text" id="keyword" placeholder="장소를 검색하세요">
            <button id="searchBtn">검색</button>
        </div>
        <div class="lineH"></div>
    </section>
    <div id="footer"></div>

<script type="text/javascript" src="EFFE.js"></script>
<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=1ce51ad03576a5eb772af03ad556cda2&libraries=services,clusterer,drawing&autoload=false"></script>
<script>
window.addEventListener('DOMContentLoaded', () => {
    kakao.maps.load(() => {
        const mapContainer = document.querySelector('.tomMap');
        const map = new kakao.maps.Map(mapContainer, {
            center: new kakao.maps.LatLng(37.5284458, 127.0401040),
            level: 3
        });

        const tomPosition = new kakao.maps.LatLng(37.5284458, 127.0401040);

        // 마커
        const tomMarker = new kakao.maps.Marker({ position: tomPosition, map });

        // 커스텀 오버레이 (왼쪽 이미지 추가)
        const overlayContent = `
            <div class="customOverlay" style="background:white;padding:10px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.3);position:relative;display:flex;align-items:center;gap:8px;">
                <img src="./source_02TOM_FORD/logoS.jpg" alt="TOM FORD 로고" style="width:50px;height:50px;border-radius:6px;flex-shrink:0;">
                <div style="flex:1; font-size:13px;">
                    <div style="position:relative;">
                        TOM FORD 매장<br>강남구 압구정로 343 갤러리아
                        <div class="close-btn" style="position:absolute;top:-5px;right:-5px;width:16px;height:16px;cursor:pointer;font-weight:bold;z-index:10;">×</div>
                    </div>
                </div>
            </div>
        `;

        const overlay = new kakao.maps.CustomOverlay({
            content: overlayContent,
            position: new kakao.maps.LatLng(tomPosition.getLat() + 0.0004, tomPosition.getLng()),
            yAnchor: 1
        });
        overlay.setMap(map);

        // X 버튼 클릭 시 오버레이 제거
        const closeOverlayBtn = document.querySelector('.tomMap .customOverlay .close-btn');
        closeOverlayBtn.addEventListener('click', () => overlay.setMap(null));

        // 마커 클릭 시 오버레이 다시 표시
        kakao.maps.event.addListener(tomMarker, 'click', () => overlay.setMap(map));

        // 교통/자전거 오버레이
        const mapTypes = {
            traffic : kakao.maps.MapTypeId.TRAFFIC,
            bicycle : kakao.maps.MapTypeId.BICYCLE
        };
        const activeOverlays = {};

        document.querySelectorAll('.mapTypeBox button[data-type]').forEach(btn => {
            btn.addEventListener('click', () => {
                const type = btn.dataset.type;
                if (activeOverlays[type]) {
                    map.removeOverlayMapTypeId(mapTypes[type]);
                    activeOverlays[type] = false;
                } else {
                    map.addOverlayMapTypeId(mapTypes[type]);
                    activeOverlays[type] = true;
                }
            });
        });

        // 검색 기능
        const ps = new kakao.maps.services.Places();
        const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });
        let searchMarkers = [];

        document.getElementById('searchBtn').addEventListener('click', () => {
            const keyword = document.getElementById('keyword').value.trim();
            if(!keyword) { alert('검색어를 입력하세요!'); return; }
            ps.keywordSearch(keyword, placesSearchCB);
        });

        function placesSearchCB(data, status){
            if(status === kakao.maps.services.Status.OK){
                searchMarkers.forEach(m => m.setMap(null));
                searchMarkers = [];
                const bounds = new kakao.maps.LatLngBounds();
                data.forEach(place => {
                    const marker = new kakao.maps.Marker({
                        position: new kakao.maps.LatLng(place.y, place.x),
                        map: map
                    });
                    kakao.maps.event.addListener(marker, 'click', () => {
                        infowindow.setContent(`<div style="padding:5px;font-size:13px;">${place.place_name}</div>`);
                        infowindow.open(map, marker);
                    });
                    searchMarkers.push(marker);
                    bounds.extend(marker.getPosition());
                });
                map.setBounds(bounds);
            } else {
                alert('검색 결과가 없습니다.');
            }
        }

        // 지도 컨트롤
        const mapTypeControl = new kakao.maps.MapTypeControl();
        map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPLEFT);
        const zoomControl = new kakao.maps.ZoomControl();
        map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

        window.currentTypeId = null;
        window.setOverlayMapTypeId = function(type){
            let overlayType;
            if(type === 'traffic') overlayType = kakao.maps.MapTypeId.TRAFFIC;
            else if(type === 'bicycle') overlayType = kakao.maps.MapTypeId.BICYCLE;

            if(window.currentTypeId) map.removeOverlayMapTypeId(window.currentTypeId);
            map.addOverlayMapTypeId(overlayType);
            window.currentTypeId = overlayType;

            overlay.setMap(map);
        }

        // 편의점 / 주차장 마커
        const markerSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png';

        const storePositions = [
            new kakao.maps.LatLng(37.5273635, 127.0405768),
            new kakao.maps.LatLng(37.5277111, 127.0398715),
            new kakao.maps.LatLng(37.5272101, 127.0407618)
        ];
        const carparkPositions = [
            new kakao.maps.LatLng(37.5272188, 127.0402271),
            new kakao.maps.LatLng(37.5281863, 127.0380787),
            new kakao.maps.LatLng(37.5272221, 127.0392215)
        ];

        function createCategoryMarker(pos, spriteY){
            const imageSize = new kakao.maps.Size(22,26);
            const imageOptions = { spriteOrigin: new kakao.maps.Point(10, spriteY), spriteSize: new kakao.maps.Size(36,98) };
            const markerImage = new kakao.maps.MarkerImage(markerSrc, imageSize, imageOptions);
            return new kakao.maps.Marker({ position: pos, image: markerImage, map: null });
        }

        const storeMarkers = storePositions.map(pos => createCategoryMarker(pos, 36));
        const carparkMarkers = carparkPositions.map(pos => createCategoryMarker(pos, 72));

        window.changeMarker = function(type){
            if(type === 'store'){
                storeMarkers.forEach(m => m.setMap(map));
                carparkMarkers.forEach(m => m.setMap(null));
            } else if(type === 'carpark'){
                carparkMarkers.forEach(m => m.setMap(map));
                storeMarkers.forEach(m => m.setMap(null));
            }
        }
    });
});
</script>

</body>
</html>