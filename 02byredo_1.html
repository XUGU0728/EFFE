<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EFFÉ</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="EFFE.css" />
    <link rel="stylesheet" href="reset.css" />
</head>
<body>
    <div id="header"></div>
    <section class="byredoI01">
        <div class="byredoILogo"><img src="./source_01BYREDO/logo.png" alt="logo"></div>
        <div class="byredoILogoSen">The Scent of Memory</div>
        <div class="byredoIMain"><img src="./source_01BYREDO/531.jpg" alt="img"></div>
        <div class="byredoIValue">
            <div class="lineH"></div>
            <div class="byredoIVText">“We capture memories in scent, translating emotion into olfactory art.”</div>
            <div class="lineH"></div>
        </div>
    </section>
    <section class="byredoI02">
        <div class="byredoCBox">
            <div class="byredoCImg01"><img src="./source_01BYREDO/635.jpg" alt="img"></div>
            <div class="byredoCText">Modern Sensibility</div>
        </div>
        <div class="byredoCBox">
            <div class="byredoCText">Contemporary Minimalism</div>
            <div class="byredoCImg02"><img src="./source_01BYREDO/13.jpg" alt="img"></div>
        </div>
        <div class="lineV"></div>
    </section>
    <section class="byredoI03">
        <div class="flipCard">
            <div class="flipCardIn">
                <div class="flipFront">
                    <div class="frontImg"><img src="./source_01BYREDO/BLANCHE.jpeg" alt="img"></div>
                </div>
                <div class="flipBack">
                    <div class="lineH"></div>
                    <div>Blanche</div>
                    <div>x</div>
                    <div>purity | linen | gentle clarity</div>
                    <div class="lineH"></div>
                </div>
            </div>
        </div>
        <div class="flipCard">
            <div class="flipCardIn">
                <div class="flipFront">
                    <div class="frontImg"><img src="./source_01BYREDO/MOJAVE_GHOST.jpeg" alt="img"></div>
                </div>
                <div class="flipBack">
                    <div class="lineH"></div>
                    <div>Mojave Ghost</div>
                    <div>x</div>
                    <div>earthy | free | poetic nostalgia</div>
                    <div class="lineH"></div>
                </div>
            </div>
        </div>
        <div class="flipCard">
            <div class="flipCardIn">
                <div class="flipFront">
                    <div class="frontImg"><img src="./source_01BYREDO/GYPSY_WATER.jpeg" alt="img"></div>
                </div>
                <div class="flipBack">
                    <div class="lineH"></div>
                    <div>Gypsy Water</div>
                    <div>x</div>
                    <div>airy | mysterious | desert bloom</div>
                    <div class="lineH"></div>
                </div>
            </div>
        </div>
    </section>
    <section class="byredoI04">
        <div class="lineV"></div>
        <div class="byredoFSen">
            modern romance · artistic clarity · soft individuality
        </div>
        <div class="byredoFImgBox">
            <div class="byredoFImg">
                <img src="./source_01BYREDO/11.jpg" alt="img">
            </div>
            <div class="byredoFImg">
                <img src="./source_01BYREDO/06.jpg" alt="img">
            </div>
        </div>
        <div class="lineH"></div>
    </section>
    <section class="byredoI05">
        <div class="byredoIMapText">BYREDO Flagship Store</div>
        <div class="byredoMap"></div>
        <div class="searchBox">
            <input type="text" id="keyword" placeholder="장소를 검색하세요">
            <button id="searchBtn">검색</button>
        </div>
        <div class="lineH"></div>
    </section>
    <div id="footer"></div>

<script type="text/javascript" src="EFFE.js"></script>
<script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_APP_KEY&libraries=services,clusterer,drawing&autoload=false"></script>
<script>
window.addEventListener('DOMContentLoaded', () => {
  kakao.maps.load(() => {
    const mapContainer = document.querySelector('.byredoMap');
    const mapOption = { center: new kakao.maps.LatLng(37.5212119, 127.0220863), level: 3 };
    const map = new kakao.maps.Map(mapContainer, mapOption);

    const ps = new kakao.maps.services.Places();
    const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });
    let markers = [];

    const byredoPosition = new kakao.maps.LatLng(37.520708, 127.022684);
    const byredoMarker = new kakao.maps.Marker({ map, position: byredoPosition });
    const byredoInfo = new kakao.maps.InfoWindow({
      content: '<div style="padding:8px;font-size:13px;">BYREDO 가로수길점<br>서울특별시 강남구 압구정로10길 21</div>'
    });
    byredoInfo.open(map, byredoMarker);

    // 검색 기능
    document.getElementById('searchBtn')?.addEventListener('click', () => {
      const keyword = document.getElementById('keyword')?.value.trim();
      if (!keyword) { alert('검색어를 입력하세요!'); return; }
      ps.keywordSearch(keyword, placesSearchCB);
    });

    function placesSearchCB(data, status) {
      if (status === kakao.maps.services.Status.OK) {
        markers.forEach(marker => marker.setMap(null));
        markers = [];
        const bounds = new kakao.maps.LatLngBounds();
        data.forEach(place => {
          const marker = new kakao.maps.Marker({ map, position: new kakao.maps.LatLng(place.y, place.x) });
          markers.push(marker);
          kakao.maps.event.addListener(marker, 'click', () => {
            infowindow.setContent(`<div style="padding:5px;font-size:13px;">${place.place_name}</div>`);
            infowindow.open(map, marker);
          });
          bounds.extend(new kakao.maps.LatLng(place.y, place.x));
        });
        map.setBounds(bounds);
      } else {
        alert('검색 결과가 없습니다.');
      }
    }

    // 지도 컨트롤
    const mapTypeControl = new kakao.maps.MapTypeControl();
    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPLEFT);
    const zoomControl = new kakao.maps.ZoomControl();
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

    // ---------------- 길찾기 기능 ----------------
    let polyline = null;
    const infoDiv = document.getElementById('info');

    document.getElementById('routeBtn').addEventListener('click', async () => {
      let startLat, startLng;
      const startInput = document.getElementById('start').value.trim();
      const mode = document.getElementById('mode').value; // WALK / CAR / BICYCLE
      if (!startInput) {
        // 현재 위치
        if (navigator.geolocation) {
          await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(pos => {
              startLat = pos.coords.latitude;
              startLng = pos.coords.longitude;
              resolve();
            }, reject);
          });
        } else { alert('현재 위치를 가져올 수 없습니다.'); return; }
      } else {
        alert('현재는 주소 입력 미지원, 빈칸 사용');
        return;
      }

      const endLat = 37.520708;
      const endLng = 127.022684;
      const REST_API_KEY = '15b798050eded0e471e45ca9c8f69798';
      const url = `https://apis-navi.kakaomobility.com/v1/directions?origin=${startLng},${startLat}&destination=${endLng},${endLat}&priority=${mode}`;

      try {
        const res = await fetch(url, { headers: { Authorization: `KakaoAK ${REST_API_KEY}` } });
        const data = await res.json();
        if (!data.routes || data.routes.length === 0) { alert('경로를 찾을 수 없습니다.'); return; }

        if (polyline) polyline.setMap(null);
        const path = [];
        let totalDistance = 0;
        let totalTime = 0;

        const roads = data.routes[0].sections[0].roads;
        roads.forEach(road => {
          totalDistance += road.distance;
          totalTime += road.duration;
          road.vertexes.forEach((v,i) => { if(i%2===0) path.push(new kakao.maps.LatLng(road.vertexes[i+1], road.vertexes[i])); });
        });

        polyline = new kakao.maps.Polyline({ map, path, strokeWeight:5, strokeColor:'#2E9AFE', strokeOpacity:0.9, strokeStyle:'solid' });
        const bounds = new kakao.maps.LatLngBounds(); path.forEach(p=>bounds.extend(p)); map.setBounds(bounds);

        infoDiv.innerHTML = `<strong>거리:</strong> ${(totalDistance/1000).toFixed(2)} km | <strong>예상 소요 시간:</strong> ${Math.floor(totalTime/60)}분`;
      } catch(err) {
        console.error(err); alert('길찾기 요청 중 오류 발생');
      }
    });
  });
});
</script>


</body>
</html>